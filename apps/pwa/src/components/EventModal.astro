---
import { Image } from 'astro:assets';

interface Organizer {
    name: string;
    avatar: string;
}

interface Event {
    id: string;
    title: string;
    description: string;
    date: string;
    time: string;
    location: string;
    image: string;
    category: string;
    organizer: Organizer;
    price: string;
    attendees: number;
    maxAttendees: number;
}

interface NavigationEvent {
    id: string;
    title: string;
    image: string;
}

interface Props {
    event: Event;
    prevEvent?: NavigationEvent;
    nextEvent?: NavigationEvent;
}

const { event, prevEvent, nextEvent } = Astro.props;
---

<div
    id="event-modal"
    class="fixed inset-0 z-50 overflow-y-auto"
    aria-labelledby="modal-title"
    role="dialog"
    aria-modal="true"
    style="display: none;"
>
    <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <!-- Background overlay -->
        <div class="fixed inset-0 bg-gray-900 bg-opacity-75 transition-opacity" aria-hidden="true"></div>

        <!-- Modal panel -->
        <div
            class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-7xl sm:w-full"
        >
            <div class="absolute top-0 right-0 pt-4 pr-4 z-10">
                <button
                    type="button"
                    class="close-modal bg-white rounded-md p-2 inline-flex items-center justify-center text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-cebby-primary"
                >
                    <span class="sr-only">Close modal</span>
                    <svg
                        class="h-6 w-6"
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                    >
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"
                        ></path>
                    </svg>
                </button>
            </div>

            <div class="flex flex-col lg:flex-row">
                <!-- Left Column - Image and Navigation -->
                <div class="relative w-full lg:w-2/3">
                    <img src={event.image} alt={event.title} class="w-full h-[400px] lg:h-[600px] object-cover" />

                    <!-- Navigation Buttons -->
                    <div class="absolute inset-y-0 left-0 right-0 flex items-center justify-between px-4">
                        {
                            prevEvent && (
                                <a
                                    href={`/events/${prevEvent.id}`}
                                    class="prev-event group relative bg-white/10 hover:bg-white/20 backdrop-blur-sm rounded-full p-2 transition-all"
                                >
                                    <span class="sr-only">Previous event</span>
                                    <svg
                                        class="h-8 w-8 text-white"
                                        fill="none"
                                        viewBox="0 0 24 24"
                                        stroke="currentColor"
                                    >
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M15 19l-7-7 7-7"
                                        />
                                    </svg>
                                    <div class="absolute left-14 top-1/2 -translate-y-1/2 hidden group-hover:block bg-white rounded-lg shadow-lg p-2 w-48">
                                        <div class="flex items-center space-x-3">
                                            <img
                                                src={prevEvent.image}
                                                alt={prevEvent.title}
                                                class="w-12 h-12 object-cover rounded"
                                            />
                                            <p class="text-sm font-medium text-gray-900 line-clamp-2">
                                                {prevEvent.title}
                                            </p>
                                        </div>
                                    </div>
                                </a>
                            )
                        }
                        {
                            nextEvent && (
                                <a
                                    href={`/events/${nextEvent.id}`}
                                    class="next-event group relative bg-white/10 hover:bg-white/20 backdrop-blur-sm rounded-full p-2 transition-all"
                                >
                                    <span class="sr-only">Next event</span>
                                    <svg
                                        class="h-8 w-8 text-white"
                                        fill="none"
                                        viewBox="0 0 24 24"
                                        stroke="currentColor"
                                    >
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M9 5l7 7-7 7"
                                        />
                                    </svg>
                                    <div class="absolute right-14 top-1/2 -translate-y-1/2 hidden group-hover:block bg-white rounded-lg shadow-lg p-2 w-48">
                                        <div class="flex items-center space-x-3">
                                            <img
                                                src={nextEvent.image}
                                                alt={nextEvent.title}
                                                class="w-12 h-12 object-cover rounded"
                                            />
                                            <p class="text-sm font-medium text-gray-900 line-clamp-2">
                                                {nextEvent.title}
                                            </p>
                                        </div>
                                    </div>
                                </a>
                            )
                        }
                    </div>
                </div>

                <!-- Right Column - Event Details -->
                <div class="w-full lg:w-1/3 p-6 lg:p-8">
                    <div class="h-full flex flex-col">
                        <div class="flex-1">
                            <span
                                class={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-${event.category.toLowerCase()}-100 text-${event.category.toLowerCase()}-800 mb-4`}
                            >
                                {event.category}
                            </span>
                            <h2 class="text-2xl font-bold text-gray-900 mb-4">{event.title}</h2>

                            <div class="space-y-4 mb-6">
                                <div class="flex items-center text-gray-600">
                                    <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                                        ></path>
                                    </svg>
                                    <span>{event.date} at {event.time}</span>
                                </div>
                                <div class="flex items-center text-gray-600">
                                    <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                                        ></path>
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    </svg>
                                    <span>{event.location}</span>
                                </div>
                                <div class="flex items-center text-gray-600">
                                    <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"
                                        ></path>
                                    </svg>
                                    <span>{event.price}</span>
                                </div>
                            </div>

                            <div class="prose prose-sm max-w-none mb-6">
                                <p>{event.description}</p>
                            </div>

                            <div class="flex items-center space-x-4 mb-6">
                                <img
                                    src={event.organizer.avatar}
                                    alt={event.organizer.name}
                                    class="w-12 h-12 rounded-full"
                                />
                                <div>
                                    <p class="text-sm font-medium text-gray-900">Organized by</p>
                                    <p class="text-sm text-gray-600">{event.organizer.name}</p>
                                </div>
                            </div>

                            <div class="bg-gray-50 rounded-lg p-4 mb-6">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm font-medium text-gray-900">Attendees</span>
                                    <span class="text-sm text-gray-600">{event.attendees}/{event.maxAttendees}</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div
                                        class="bg-cebby-primary rounded-full h-2"
                                        style={`width: ${(event.attendees / event.maxAttendees) * 100}%`}
                                    >
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-auto">
                            <button
                                type="button"
                                class="w-full inline-flex justify-center items-center px-6 py-3 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-cebby-primary hover:bg-cebby-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cebby-primary"
                            >
                                RSVP to Event
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    declare global {
        function setupModal(): void;
    }

    function setupModal() {
        const modal = document.getElementById('event-modal');
        const closeButton = modal?.querySelector('.close-modal');

        // Close modal when clicking the close button
        closeButton?.addEventListener('click', () => {
            modal?.style.setProperty('display', 'none');
            history.pushState({}, '', '/events');
        });

        // Close modal when clicking outside
        modal?.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.style.setProperty('display', 'none');
                history.pushState({}, '', '/events');
            }
        });

        // Close modal when pressing Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modal?.style.display !== 'none') {
                modal?.style.setProperty('display', 'none');
                history.pushState({}, '', '/events');
            }
        });

        // Handle browser back button
        window.addEventListener('popstate', () => {
            modal?.style.setProperty('display', 'none');
        });
    }

    // Initialize modal functionality
    setupModal();
</script>

